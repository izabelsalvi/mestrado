library("pdftools")
library("tidyverse")
library("ggplot2")
raw_text <- map("tentativa_extrair_tab_pdf/Thesis_Revised-192-194.pdf", pdf_text)
clean_table1 <- function(raw) {
raw <- map(raw, ~ str_split(.x, "\\n") %>% unlist())
raw <- reduce(raw, c)
#specify the start and end of the table
table_start <- stringr::str_which(tolower(raw), "MTR14578*")
table_end <- stringr::str_which(tolower(raw), "58")
table_end <- table_end[min(which(table_end > table_start))]
#build the table and remove special characters
table <- raw[(table_start):(table_end)]
table <- str_replace_all(table, "\\s{2,}", "|")
text_con <- textConnection(table)
data_table <- read.csv(text_con, sep = "|")
}
results <- map_df(raw_text, clean_table1)
raw_text <- map("tentativa_extrair_tab_pdf/Thesis_Revised-192-194.pdf", pdf_text)
clean_table1 <- function(raw) {
raw <- map(raw, ~ str_split(.x, "\\n") %>% unlist())
raw <- reduce(raw, c)
#specify the start and end of the table
table_start <- stringr::str_which(tolower(raw), "MTR14578*")
table_end <- stringr::str_which(tolower(raw), "58")
table_end <- table_end[min(which(table_end > table_start))]
#build the table and remove special characters
table <- raw[(table_start):(table_end)]
table <- str_replace_all(table, "\\s{2,}", "|")
text_con <- textConnection(table)
data_table <- read.csv(text_con, sep = "|")
}
results <- map_df(raw_text, clean_table1)
rlang::last_error()
rlang::last_trace()
# download pdf and load file
url <- c("http://www.cicad.oas.org/oid/pubs/JamaicaNationalHouseholdDrugSurvey2017ENG.pdf")
raw_text <- map(url, pdf_text)
#function to scrape data and clean
clean_table1 <- function(raw) {
# Split the single pages
raw <- map(raw, ~ str_split(.x, "\\n") %>% unlist())
# Concatenate the split pages
raw <- reduce(raw, c)
# specify the start and end of the table data
table_start <- stringr::str_which(tolower(raw), "alcohol use pattern")
table_end <- stringr::str_which(tolower(raw), "never used")
table_end <- table_end[min(which(table_end > table_start))]
#Build the table  and remove special characters
table <- raw[(table_start):(table_end)]
table <- str_replace_all(table, "\\s{2,}", "|")
text_con <- textConnection(table)
data_table <- read.csv(text_con, sep = "|")
#Create a list of column names
colnames(data_table) <- c("x","Alcohol Use Pattern", "Males","Females","Total")
data_table
}
results <- map_df(raw_text, clean_table1)
results <- map_df(raw_text, clean_table1)
head(results)
# download pdf and load file
url <- c("https://drive.google.com/file/d/1w1d0LAj8tAhEChzNqXvvaGzYdIEipL4v/view?usp=share_link")
raw_text <- map(url, pdf_text)
#function to scrape data and clean
clean_table1 <- function(raw) {
# Split the single pages
raw <- map(raw, ~ str_split(.x, "\\n") %>% unlist())
# Concatenate the split pages
raw <- reduce(raw, c)
# specify the start and end of the table data
table_start <- stringr::str_which(tolower(raw), "alcohol use pattern")
table_end <- stringr::str_which(tolower(raw), "never used")
table_end <- table_end[min(which(table_end > table_start))]
#Build the table  and remove special characters
table <- raw[(table_start):(table_end)]
table <- str_replace_all(table, "\\s{2,}", "|")
text_con <- textConnection(table)
data_table <- read.csv(text_con, sep = "|")
#Create a list of column names
colnames(data_table) <- c("x","Alcohol Use Pattern", "Males","Females","Total")
data_table
}
# download pdf and load file
url <- c("https://drive.google.com/file/d/1w1d0LAj8tAhEChzNqXvvaGzYdIEipL4v/view?usp=share_link")
raw_text <- map(url, pdf_text)
# download pdf and load file
url <- c("file:///C:/Users/izabe/Downloads/Thesis_Revised-192-194-1.pdf")
raw_text <- map(url, pdf_text)
# download pdf and load file
url <- c("tentativa_extrair_tab_pdf/Thesis_Revised-192-194.pdf")
raw_text <- map(url, pdf_text)
#function to scrape data and clean
clean_table1 <- function(raw) {
# Split the single pages
raw <- map(raw, ~ str_split(.x, "\\n") %>% unlist())
# Concatenate the split pages
raw <- reduce(raw, c)
# specify the start and end of the table data
table_start <- stringr::str_which(tolower(raw), "MTR14578*")
table_end <- stringr::str_which(tolower(raw), "MRT6435")
table_end <- table_end[min(which(table_end > table_start))]
#Build the table  and remove special characters
table <- raw[(table_start):(table_end)]
table <- str_replace_all(table, "\\s{2,}", "|")
text_con <- textConnection(table)
data_table <- read.csv(text_con, sep = "|")
}
results <- map_df(raw_text, clean_table1)
